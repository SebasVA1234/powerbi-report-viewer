<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecualand - Sistema de Reportes</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/windows.css">
</head>
<body>
    <div id="app">
        <!-- ========== P√ÅGINA DE LOGIN ========== -->
        <div id="login-page" class="page active">
            <div class="login-container">
                <div class="login-card">
                    <div class="login-header">
                        <div class="logo">
                            <img src="img/logo-bg complete.png" alt="Ecualand Flowers & Logistics">
                        </div>
                        <h1>Sistema de Reportes</h1>
                        <p>Ecualand Flowers & Logistics</p>
                    </div>
                    <form id="login-form" class="login-form">
                        <div class="form-group">
                            <label>Usuario o Email</label>
                            <input type="text" id="username" name="username" required autocomplete="username" placeholder="Ingresa tu usuario">
                        </div>
                        <div class="form-group">
                            <label>Contrase√±a</label>
                            <input type="password" id="password" name="password" required autocomplete="current-password" placeholder="Ingresa tu contrase√±a">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <span>Iniciar Sesi√≥n</span>
                        </button>
                    </form>
                    <div class="login-footer">
                        <p class="text-muted">¬© 2024 Ecualand Flowers & Logistics</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== P√ÅGINA PRINCIPAL (DASHBOARD) ========== -->
        <div id="dashboard-page" class="page">
            <div class="app-layout">
                <!-- Sidebar -->
                <aside class="sidebar" id="sidebar">
                    <div class="sidebar-header">
                        <img src="img/logo-bg complete.png" alt="Ecualand" class="sidebar-logo">
                    </div>
                    <nav class="sidebar-nav">
                        <button class="nav-link active" data-section="reports">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                            <span>Inicio</span>
                        </button>
                        <button class="nav-link" data-section="profile">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <span>Perfil</span>
                        </button>
                        <button class="nav-link admin-only" data-section="admin" style="display: none;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                            </svg>
                            <span>Administraci√≥n</span>
                        </button>
                    </nav>
                    <div class="sidebar-footer">
                        <button class="btn-logout-sidebar" onclick="logout()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            <span>Cerrar Sesi√≥n</span>
                        </button>
                    </div>
                </aside>

                <!-- Main Content -->
                <main class="main-wrapper">
                    <!-- Top Bar -->
                    <header class="topbar">
                        <button class="menu-toggle" id="menu-toggle">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="3" y1="12" x2="21" y2="12"></line>
                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                <line x1="3" y1="18" x2="21" y2="18"></line>
                            </svg>
                        </button>
                        <div class="search-box">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <input type="text" placeholder="Buscar reportes..." id="search-reports">
                        </div>
                        <div class="topbar-right">
                            <div class="user-menu">
                                <div class="user-avatar" id="user-avatar">U</div>
                                <div class="user-details">
                                    <span class="user-name" id="current-user-name">Usuario</span>
                                    <span class="user-role" id="current-user-role">Rol</span>
                                </div>
                            </div>
                        </div>
                    </header>

                    <!-- Content Area -->
                    <div class="content-area">
                        <!-- Secci√≥n: Inicio / Reportes -->
                        <section id="reports-section" class="content-section active">
                            <div class="welcome-header">
                                <div>
                                    <h1>Bienvenido de vuelta, <span id="welcome-name">Usuario</span> üëã</h1>
                                    <p>Aqu√≠ tienes tus reportes disponibles.</p>
                                </div>
                                <div class="reports-counter">
                                    <span class="counter-number" id="stat-reports">0</span>
                                    <span class="counter-label">reportes</span>
                                </div>
                            </div>

                            <!-- Reports List -->
                            <div class="reports-section-header">
                                <h2>Reportes Disponibles</h2>
                                <div class="reports-actions">
                                    <button class="btn btn-outline" onclick="loadMyReports()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                            <polyline points="23 4 23 10 17 10"></polyline>
                                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                                        </svg>
                                        Actualizar
                                    </button>
                                </div>
                            </div>
                            <div id="reports-container" class="reports-list"></div>
                        </section>

                        <!-- Secci√≥n: Perfil -->
                        <section id="profile-section" class="content-section">
                            <div class="section-title">
                                <h2>Mi Perfil</h2>
                                <p>Gestiona tu informaci√≥n personal</p>
                            </div>
                            <div class="profile-grid">
                                <div class="profile-card-new">
                                    <div class="profile-card-header">
                                        <div class="profile-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="12" cy="7" r="4"></circle>
                                            </svg>
                                        </div>
                                        <h3>Informaci√≥n Personal</h3>
                                    </div>
                                    <form id="profile-form" class="profile-form">
                                        <div class="form-group">
                                            <label>Usuario</label>
                                            <input type="text" id="profile-username" readonly class="input-readonly">
                                        </div>
                                        <div class="form-group">
                                            <label>Email</label>
                                            <input type="email" id="profile-email" readonly class="input-readonly">
                                        </div>
                                        <div class="form-group">
                                            <label>Nombre Visible</label>
                                            <input type="text" id="profile-fullname" required placeholder="Tu nombre como aparecer√°">
                                        </div>
                                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                                    </form>
                                </div>
                            </div>
                        </section>

                        <!-- Secci√≥n: Administraci√≥n -->
                        <section id="admin-section" class="content-section">
                            <div class="section-title">
                                <h2>Administraci√≥n</h2>
                                <p>Gestiona usuarios, reportes y permisos</p>
                            </div>
                            <div class="admin-tabs">
                                <button class="tab-btn active" data-tab="users">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="9" cy="7" r="4"></circle>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    </svg>
                                    Usuarios
                                </button>
                                <button class="tab-btn" data-tab="reports">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                    </svg>
                                    Reportes
                                </button>
                                <button class="tab-btn" data-tab="permissions">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                    </svg>
                                    Permisos
                                </button>
                                <button class="tab-btn" data-tab="settings">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                        <circle cx="12" cy="12" r="3"></circle>
                                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                                    </svg>
                                    Configuraci√≥n
                                </button>
                            </div>

                            <!-- Tab: Usuarios -->
                            <div id="users-tab" class="tab-content active">
                                <div class="tab-header">
                                    <h3>Gesti√≥n de Usuarios</h3>
                                    <button class="btn btn-primary" onclick="showCreateUserModal()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                        Nuevo Usuario
                                    </button>
                                </div>
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Usuario</th>
                                                <th>Nombre</th>
                                                <th>Email</th>
                                                <th>Rol</th>
                                                <th>Estado</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="users-table-body"></tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Tab: Reportes -->
                            <div id="reports-tab" class="tab-content">
                                <div class="tab-header">
                                    <h3>Gesti√≥n de Reportes</h3>
                                    <button class="btn btn-primary" onclick="showCreateReportModal()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                        Nuevo Reporte
                                    </button>
                                </div>
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Nombre</th>
                                                <th>Categor√≠a</th>
                                                <th>Descripci√≥n</th>
                                                <th>Usuarios</th>
                                                <th>Estado</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="reports-table-body"></tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Tab: Permisos -->
                            <div id="permissions-tab" class="tab-content">
                                <div class="tab-header">
                                    <h3>Matriz de Permisos</h3>
                                </div>
                                <div id="permissions-matrix" class="matrix-container"></div>
                            </div>

                            <!-- Tab: Configuraci√≥n -->
                            <div id="settings-tab" class="tab-content">
                                <div class="tab-header">
                                    <h3>Configuraci√≥n del Sistema</h3>
                                </div>
                                <div class="settings-container">
                                    <div class="settings-section">
                                        <h4>Visualizaci√≥n de Reportes</h4>
                                        <div class="setting-item">
                                            <div class="setting-info">
                                                <label for="max-windows">M√°ximo de ventanas abiertas</label>
                                                <p class="setting-description">Cantidad m√°xima de reportes que un usuario puede tener abiertos simult√°neamente (1-10)</p>
                                            </div>
                                            <div class="setting-control">
                                                <input type="number" id="max-windows" min="1" max="10" value="5">
                                                <button class="btn btn-primary btn-sm" onclick="saveMaxWindows()">Guardar</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="settings-section">
                                        <h4>Informaci√≥n del Sistema</h4>
                                        <div class="system-info">
                                            <div class="info-item">
                                                <span class="info-label">Versi√≥n:</span>
                                                <span class="info-value">1.0.0</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Base de datos:</span>
                                                <span class="info-value">SQLite</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </main>
            </div>
        </div>

        <!-- ========== MODALES ========== -->
        <!-- Modal: Ver Reporte -->
        <div id="report-viewer" class="modal">
            <div class="modal-content report-viewer-content">
                <div class="report-viewer-header">
                    <h3 id="report-viewer-title">Reporte</h3>
                    <button class="btn-close" onclick="closeReportViewer()">&times;</button>
                </div>
                <div class="report-viewer-body">
                    <iframe id="report-iframe" frameborder="0" allowFullScreen="true"></iframe>
                </div>
            </div>
        </div>

        <!-- Modal: Crear Usuario -->
        <div id="create-user-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Crear Nuevo Usuario</h3>
                    <button class="btn-close" onclick="closeModal('create-user-modal')">&times;</button>
                </div>
                <form id="create-user-form">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Usuario</label>
                            <input type="text" name="username" required placeholder="nombre.usuario">
                        </div>
                        <div class="form-group">
                            <label>Nombre Completo</label>
                            <input type="text" name="full_name" required placeholder="Nombre Apellido">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" name="email" required placeholder="correo@ecualand.ec">
                        </div>
                        <div class="form-group">
                            <label>Contrase√±a</label>
                            <input type="password" name="password" required minlength="6" placeholder="M√≠nimo 6 caracteres">
                        </div>
                        <div class="form-group">
                            <label>Rol</label>
                            <select name="role" required>
                                <option value="user">Usuario</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline" onclick="closeModal('create-user-modal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Crear Usuario</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal: Editar Usuario -->
        <div id="edit-user-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Editar Usuario</h3>
                    <button class="btn-close" onclick="closeModal('edit-user-modal')">&times;</button>
                </div>
                <form id="edit-user-form">
                    <div class="modal-body">
                        <input type="hidden" id="edit-user-id">
                        <div class="form-group">
                            <label>Usuario</label>
                            <input type="text" id="edit-user-username" required>
                        </div>
                        <div class="form-group">
                            <label>Nombre Completo</label>
                            <input type="text" id="edit-user-fullname" required>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="edit-user-email" required>
                        </div>
                        <div class="form-group">
                            <label>Contrase√±a Actual</label>
                            <div class="input-with-button">
                                <input type="password" id="edit-user-current-password" readonly value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                <button type="button" class="btn-icon" onclick="togglePasswordVisibility()">
                                    <svg id="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Nueva Contrase√±a (opcional)</label>
                            <input type="password" id="edit-user-password" minlength="6" placeholder="Dejar vac√≠o para no cambiar">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Rol</label>
                                <select id="edit-user-role" required>
                                    <option value="user">Usuario</option>
                                    <option value="admin">Administrador</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Estado</label>
                                <select id="edit-user-active" required>
                                    <option value="1">Activo</option>
                                    <option value="0">Inactivo</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline" onclick="closeModal('edit-user-modal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal: Crear Reporte -->
        <div id="create-report-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Crear Nuevo Reporte</h3>
                    <button class="btn-close" onclick="closeModal('create-report-modal')">&times;</button>
                </div>
                <form id="create-report-form">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Nombre del Reporte</label>
                            <input type="text" name="name" required placeholder="Dashboard de Ventas">
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea name="description" rows="3" placeholder="Descripci√≥n del reporte..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>URL de Power BI</label>
                            <input type="url" name="embed_url" required placeholder="https://app.powerbi.com/view?r=...">
                        </div>
                        <div class="form-group">
                            <label>Categor√≠a</label>
                            <input type="text" name="category" placeholder="Ventas, Finanzas, Operaciones...">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline" onclick="closeModal('create-report-modal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Crear Reporte</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal: Editar Reporte -->
        <div id="edit-report-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Editar Reporte</h3>
                    <button class="btn-close" onclick="closeModal('edit-report-modal')">&times;</button>
                </div>
                <form id="edit-report-form">
                    <div class="modal-body">
                        <input type="hidden" name="id" id="edit-report-id">
                        <div class="form-group">
                            <label>Nombre del Reporte</label>
                            <input type="text" name="name" id="edit-report-name" required>
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea name="description" id="edit-report-description" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label>URL de Power BI</label>
                            <input type="url" name="embed_url" id="edit-report-url" required>
                        </div>
                        <div class="form-group">
                            <label>Categor√≠a</label>
                            <input type="text" name="category" id="edit-report-category">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline" onclick="closeModal('edit-report-modal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal: Gestionar Accesos -->
        <div id="access-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="access-modal-title">Accesos del Reporte</h3>
                    <button class="btn-close" onclick="closeModal('access-modal')">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="access-report-id">
                    <div id="user-list-checkboxes"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('access-modal')">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="savePermissions()">Guardar Accesos</button>
                </div>
            </div>
        </div>

        <!-- Notificaciones -->
        <div id="notification-container"></div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/windows.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
